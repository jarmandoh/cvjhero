<div class="editor-container bg-white border border-gray-300 rounded-lg shadow-sm">
  <!-- Toolbar -->
  @if (!readonly) {
    <div class="editor-toolbar bg-gray-50 border-b border-gray-200 p-2 flex flex-wrap items-center gap-1">
    
    <!-- Text Formatting -->
    <div class="toolbar-group flex gap-1">
      <button 
        type="button"
        (click)="formatText('bold')"
        [class.active]="isCommandActive('bold')"
        class="toolbar-btn"
        title="Negrita"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M4 3a1 1 0 000 2h1v10a1 1 0 001 1h6a4 4 0 002.5-7.15A3.5 3.5 0 0011.5 3H4zm7 5.5a1.5 1.5 0 110 3H7V8.5h4z"/>
        </svg>
      </button>

      <button 
        type="button"
        (click)="formatText('italic')"
        [class.active]="isCommandActive('italic')"
        class="toolbar-btn"
        title="Cursiva"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 3a1 1 0 011 1v1h2a1 1 0 110 2h-1l-1 8h1a1 1 0 110 2h-2a1 1 0 01-1-1v-1H7a1 1 0 110-2h1l1-8H8a1 1 0 110-2h2V4a1 1 0 011-1z"/>
        </svg>
      </button>

      <button 
        type="button"
        (click)="formatText('underline')"
        [class.active]="isCommandActive('underline')"
        class="toolbar-btn"
        title="Subrayado"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M6 2a1 1 0 000 2v7a4 4 0 108 0V4a1 1 0 112 0v7a6 6 0 01-12 0V4a1 1 0 000-2h2zM4 17a1 1 0 100 2h12a1 1 0 100-2H4z"/>
        </svg>
      </button>
    </div>

    <div class="toolbar-separator"></div>

    <!-- Headings -->
    <div class="toolbar-group flex gap-1">
      <button 
        type="button"
        (click)="formatText('formatBlock', 'h1')"
        class="toolbar-btn"
        title="TÃ­tulo 1"
      >
        H1
      </button>

      <button 
        type="button"
        (click)="formatText('formatBlock', 'h2')"
        class="toolbar-btn"
        title="TÃ­tulo 2"
      >
        H2
      </button>

      <button 
        type="button"
        (click)="formatText('formatBlock', 'h3')"
        class="toolbar-btn"
        title="TÃ­tulo 3"
      >
        H3
      </button>
    </div>

    <div class="toolbar-separator"></div>

    <!-- Lists -->
    <div class="toolbar-group flex gap-1">
      <button 
        type="button"
        (click)="insertList(false)"
        class="toolbar-btn"
        title="Lista sin numerar"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
        </svg>
      </button>

      <button 
        type="button"
        (click)="insertList(true)"
        class="toolbar-btn"
        title="Lista numerada"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M3 3a1 1 0 000 2h14a1 1 0 100-2H3zM3 7a1 1 0 000 2h14a1 1 0 100-2H3zM3 11a1 1 0 100 2h14a1 1 0 100-2H3z"/>
        </svg>
      </button>
    </div>

    <div class="toolbar-separator"></div>

    <!-- Links and Images -->
    <div class="toolbar-group flex gap-1">
      <button 
        type="button"
        (click)="createLink()"
        class="toolbar-btn"
        title="Insertar enlace"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z"/>
        </svg>
      </button>

      <button 
        type="button"
        (click)="insertImage()"
        class="toolbar-btn"
        title="Insertar imagen"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>

    <!-- Preview Toggle -->
    <div class="ml-auto flex gap-2">
      <button 
        type="button"
        (click)="togglePreview()"
        class="toolbar-btn"
        [class.active]="isPreviewMode"
        title="Vista previa"
      >
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
          <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>
  </div>
  }

  <!-- Editor/Preview Area -->
  <div class="editor-content relative">
    <!-- Editor Mode -->
    @if (!isPreviewMode) {
      <div 
        #editor
        contenteditable="true"
        [attr.data-placeholder]="placeholder"
        [innerHTML]="editorContent"
        (input)="onContentInput($event)"
        [style.height.px]="height"
        class="editor-area"
        [class.readonly]="readonly"
      ></div>
    }

    <!-- Preview Mode -->
    @if (isPreviewMode) {
      <div 
        [innerHTML]="editorContent"
        [style.height.px]="height"
        class="preview-area"
      ></div>
    }

    <!-- Status Bar -->
    <div class="status-bar bg-gray-50 border-t border-gray-200 px-3 py-2 text-xs text-gray-500 flex justify-between items-center">
      <div class="flex items-center gap-4">
        @if (hasUnsavedChanges) {
          <span class="text-yellow-600">
            â€¢ Cambios sin guardar
          </span>
        }
        @if (isAutoSaving) {
          <span class="text-blue-600">
            ðŸ”„ Guardando automÃ¡ticamente...
          </span>
        }
        @if (!hasUnsavedChanges && !isAutoSaving) {
          <span class="text-green-600">
            âœ“ Guardado
          </span>
        }
      </div>
      
      <div class="flex items-center gap-2">
        @if (hasUnsavedChanges) {
          <button 
            type="button"
            (click)="saveContent()"
            class="save-btn"
          >
            Guardar ahora
          </button>
        }
        <span>{{ editorContent.length }} caracteres</span>
      </div>
    </div>
  </div>
</div>
